{
  "LinkedTasks": {
    "74ae7f95-606a-4ea7-b236-1c928da2f6f3": [
      {
        "Id": "2831a40a-71dd-402a-978d-b304597bd7fb",
        "PackageId": "Frends.Sql",
        "PackageVersion": "1.1.31",
        "Name": "Frends.Sql.Sql.ExecuteQuery(InputQuery, Options, CancellationToken)",
        "FrameworkIdentifier": ".NETFramework"
      }
    ]
  },
  "LinkedSubProcess": {},
  "Version": "Acc41",
  "Processes": [
    {
      "Name": "INT-005 Heroma-Opene extern lista med anställda",
      "Modified": "2022-08-31T13:24:47.027",
      "Modifier": "andreas.nordman@ostersund.se",
      "TagString": null,
      "Tags": [
        "Opene",
        "Heroma",
        "Opene listor"
      ],
      "Description": "Extern lista med en viss chefs anställda",
      "Version": 54,
      "UniqueIdentifier": "74ae7f95-606a-4ea7-b236-1c928da2f6f3",
      "GraphJson": "",
      "Bpmn": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<bpmn2:definitions xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:bpmn2=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" id=\"sample-diagram\" targetNamespace=\"http://bpmn.io/schema/bpmn\" xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"><bpmn2:process id=\"Process_1\" isExecutable=\"false\"><bpmn2:task id=\"Activity_1npbxnd\" name=\"GET employees FROM DATABASE\"><bpmn2:incoming>Flow_1li65bm</bpmn2:incoming><bpmn2:outgoing>Flow_0hkiosw</bpmn2:outgoing></bpmn2:task><bpmn2:subProcess id=\"Activity_13ykkut\" name=\"Foreach employees\"><bpmn2:incoming>Flow_1cgqjnh</bpmn2:incoming><bpmn2:outgoing>Flow_07y4u7o</bpmn2:outgoing><bpmn2:multiInstanceLoopCharacteristics isSequential=\"true\" /><bpmn2:startEvent id=\"Event_0qf3jzg\"><bpmn2:outgoing>Flow_0jr2ulf</bpmn2:outgoing></bpmn2:startEvent><bpmn2:scriptTask id=\"Activity_0npnunm\" name=\"\"><bpmn2:incoming>Flow_0jr2ulf</bpmn2:incoming><bpmn2:outgoing>Flow_0j1l8m1</bpmn2:outgoing></bpmn2:scriptTask><bpmn2:sequenceFlow id=\"Flow_0jr2ulf\" sourceRef=\"Event_0qf3jzg\" targetRef=\"Activity_0npnunm\" /><bpmn2:endEvent id=\"Event_1yxk73k\"><bpmn2:incoming>Flow_0j1l8m1</bpmn2:incoming></bpmn2:endEvent><bpmn2:sequenceFlow id=\"Flow_0j1l8m1\" sourceRef=\"Activity_0npnunm\" targetRef=\"Event_1yxk73k\" /></bpmn2:subProcess><bpmn2:scriptTask id=\"Activity_0kc4zb1\" name=\"Assign list\"><bpmn2:incoming>Flow_0hkiosw</bpmn2:incoming><bpmn2:outgoing>Flow_1cgqjnh</bpmn2:outgoing></bpmn2:scriptTask><bpmn2:endEvent id=\"Event_0p5riwb\"><bpmn2:incoming>Flow_07y4u7o</bpmn2:incoming></bpmn2:endEvent><bpmn2:sequenceFlow id=\"Flow_07y4u7o\" sourceRef=\"Activity_13ykkut\" targetRef=\"Event_0p5riwb\" /><bpmn2:sequenceFlow id=\"Flow_0hkiosw\" sourceRef=\"Activity_1npbxnd\" targetRef=\"Activity_0kc4zb1\" /><bpmn2:sequenceFlow id=\"Flow_1cgqjnh\" sourceRef=\"Activity_0kc4zb1\" targetRef=\"Activity_13ykkut\" /><bpmn2:startEvent id=\"Event_1tkaan3\" name=\"API trigger\"><bpmn2:outgoing>Flow_1li65bm</bpmn2:outgoing></bpmn2:startEvent><bpmn2:sequenceFlow id=\"Flow_1li65bm\" sourceRef=\"Event_1tkaan3\" targetRef=\"Activity_1npbxnd\" /><bpmn2:textAnnotation id=\"TextAnnotation_1md2up1\"><bpmn2:text>Returnerar listan med chefens anställda</bpmn2:text></bpmn2:textAnnotation><bpmn2:association id=\"Association_19rtbq9\" sourceRef=\"Event_0p5riwb\" targetRef=\"TextAnnotation_1md2up1\" /></bpmn2:process><bpmndi:BPMNDiagram id=\"BPMNDiagram_1\"><bpmndi:BPMNPlane id=\"BPMNPlane_1\" bpmnElement=\"Process_1\"><bpmndi:BPMNEdge id=\"Flow_1li65bm_di\" bpmnElement=\"Flow_1li65bm\"><di:waypoint x=\"588\" y=\"258\" /><di:waypoint x=\"660\" y=\"258\" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id=\"Flow_1cgqjnh_di\" bpmnElement=\"Flow_1cgqjnh\"><di:waypoint x=\"825\" y=\"258\" /><di:waypoint x=\"870\" y=\"258\" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id=\"Flow_0hkiosw_di\" bpmnElement=\"Flow_0hkiosw\"><di:waypoint x=\"760\" y=\"258\" /><di:waypoint x=\"795\" y=\"258\" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id=\"Flow_07y4u7o_di\" bpmnElement=\"Flow_07y4u7o\"><di:waypoint x=\"1150\" y=\"258\" /><di:waypoint x=\"1192\" y=\"258\" /></bpmndi:BPMNEdge><bpmndi:BPMNShape id=\"Activity_1npbxnd_di\" bpmnElement=\"Activity_1npbxnd\"><dc:Bounds x=\"660\" y=\"218\" width=\"100\" height=\"80\" /></bpmndi:BPMNShape><bpmndi:BPMNShape id=\"Event_1tkaan3_di\" bpmnElement=\"Event_1tkaan3\"><dc:Bounds x=\"552\" y=\"240\" width=\"36\" height=\"36\" /><bpmndi:BPMNLabel><dc:Bounds x=\"545\" y=\"283\" width=\"53\" height=\"14\" /></bpmndi:BPMNLabel></bpmndi:BPMNShape><bpmndi:BPMNShape id=\"Activity_13ykkut_di\" bpmnElement=\"Activity_13ykkut\" isExpanded=\"true\"><dc:Bounds x=\"870\" y=\"190\" width=\"280\" height=\"140\" /></bpmndi:BPMNShape><bpmndi:BPMNEdge id=\"Flow_0j1l8m1_di\" bpmnElement=\"Flow_0j1l8m1\"><di:waypoint x=\"1034\" y=\"258\" /><di:waypoint x=\"1092\" y=\"258\" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id=\"Flow_0jr2ulf_di\" bpmnElement=\"Flow_0jr2ulf\"><di:waypoint x=\"946\" y=\"258\" /><di:waypoint x=\"1004\" y=\"258\" /></bpmndi:BPMNEdge><bpmndi:BPMNShape id=\"Event_0qf3jzg_di\" bpmnElement=\"Event_0qf3jzg\"><dc:Bounds x=\"910\" y=\"240\" width=\"36\" height=\"36\" /></bpmndi:BPMNShape><bpmndi:BPMNShape id=\"Event_1yxk73k_di\" bpmnElement=\"Event_1yxk73k\"><dc:Bounds x=\"1092\" y=\"240\" width=\"36\" height=\"36\" /></bpmndi:BPMNShape><bpmndi:BPMNShape id=\"Activity_0npnunm_di\" bpmnElement=\"Activity_0npnunm\"><dc:Bounds x=\"1004\" y=\"243\" width=\"30\" height=\"30\" /></bpmndi:BPMNShape><bpmndi:BPMNShape id=\"Activity_0kc4zb1_di\" bpmnElement=\"Activity_0kc4zb1\"><dc:Bounds x=\"795\" y=\"243\" width=\"30\" height=\"30\" /></bpmndi:BPMNShape><bpmndi:BPMNShape id=\"Event_0p5riwb_di\" bpmnElement=\"Event_0p5riwb\"><dc:Bounds x=\"1192\" y=\"240\" width=\"36\" height=\"36\" /></bpmndi:BPMNShape><bpmndi:BPMNShape id=\"TextAnnotation_1md2up1_di\" bpmnElement=\"TextAnnotation_1md2up1\"><dc:Bounds x=\"1250\" y=\"170\" width=\"130\" height=\"40\" /></bpmndi:BPMNShape><bpmndi:BPMNEdge id=\"Association_19rtbq9_di\" bpmnElement=\"Association_19rtbq9\"><di:waypoint x=\"1224\" y=\"247\" /><di:waypoint x=\"1274\" y=\"210\" /></bpmndi:BPMNEdge></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn2:definitions>",
      "ElementParameters": "[{\"Id\":\"Activity_1npbxnd\",\"Type\":1,\"Parameters\":{\"input\":{\"Query\":{\"mode\":\"sql\",\"value\":\"SELECT TRIM(A.PERSONNR) PERSONNR, TRIM(A.NAMN) NAMN, TRIM(P.KATBEN) TITLE, TRIM(O.ORG_NIVAA_3) AS FÖRV, TRIM(O.ORG_NIVAA_5) AS ENHET FROM EXTERN_VY.ANSVAR_FUNKTION A\\r\\nINNER JOIN EXTERN_VY.ORGINFO O ON A.PERSONNR = O.PERSONNR AND A.IDNR = O.IDNR\\r\\nINNER JOIN EXTERN_VY.PERSONINFO P ON A.PERSONNR = P.PERSONNR AND A.IDNR = P.IDNR\\r\\nLEFT OUTER JOIN EXTERN_VY.USERINFO X ON X.PERSONNR = A.PERSONNR\\r\\nLEFT OUTER JOIN EXTERN_VY.USERINFO U ON U.PERSONNR = A.ANSVARIG_PERSONNR\\r\\nWHERE A.FUNKTION ='Chef'\\r\\nAND O.FOERETAG = '01'\\r\\nAND P.HUVUDIDNR = 'J'\\r\\nAND P.ANONYM = 'N'\\r\\nAND P.ANST_FOM <= GETDATE() AND (P.ANST_TOM >= GETDATE()  OR P.ANST_TOM IS NULL)\\r\\nAND U.USERID = @username\"},\"Parameters\":[{\"Name\":{\"mode\":\"text\",\"value\":\"username\"},\"Value\":{\"mode\":\"csharp\",\"value\":\"#trigger.data.query.username\"}}],\"ConnectionString\":{\"mode\":\"csharp\",\"value\":\"#env.HeromaSQLConnectionstring\"}},\"options\":{\"CommandTimeoutSeconds\":{\"mode\":\"integer\",\"value\":60},\"SqlTransactionIsolationLevel\":{\"mode\":\"select\",\"value\":\"Serializable\"}},\"cancellationToken\":null},\"SelectedTypeId\":\"/ProcessTask/2831a40a-71dd-402a-978d-b304597bd7fb/v1\",\"PromoteResultAs\":null,\"Name\":\"GET employees FROM DATABASE\",\"Description\":null,\"IsDefault\":null,\"ShouldRetry\":false,\"MaxRetryCount\":null,\"ShouldNotLogResult\":null},{\"Id\":\"Event_0qf3jzg\",\"Type\":13,\"Parameters\":{},\"SelectedTypeId\":\"\",\"PromoteResultAs\":null,\"Name\":null,\"Description\":null,\"IsDefault\":null,\"ShouldRetry\":null,\"MaxRetryCount\":null,\"ShouldNotLogResult\":null},{\"Id\":\"Activity_13ykkut\",\"Type\":10,\"Parameters\":{\"variable\":\"employee\",\"expression\":{\"mode\":\"csharp\",\"value\":\"#result[GET employees FROM DATABASE]\"}},\"SelectedTypeId\":null,\"PromoteResultAs\":null,\"Name\":\"Foreach employees\",\"Description\":null,\"IsDefault\":null,\"ShouldRetry\":null,\"MaxRetryCount\":null,\"ShouldNotLogResult\":null},{\"Id\":\"Activity_0kc4zb1\",\"Type\":12,\"Parameters\":{\"variableName\":\"list\",\"variableExpression\":{\"mode\":\"csharp\",\"value\":\"new JArray()\"},\"shouldAssignVariable\":{\"mode\":\"toggle\",\"value\":true}},\"SelectedTypeId\":null,\"PromoteResultAs\":null,\"Name\":\"Assign list\",\"Description\":null,\"IsDefault\":null,\"ShouldRetry\":null,\"MaxRetryCount\":null,\"ShouldNotLogResult\":null},{\"Id\":\"Activity_0npnunm\",\"Type\":12,\"Parameters\":{\"variableName\":\"\",\"variableExpression\":{\"mode\":\"csharp\",\"value\":\"#var.list.Add(new JObject(\\r\\n    new JProperty(\\\"key\\\", #var.employee_index.ToString()),\\r\\n    new JProperty(\\\"value\\\", $\\\"{#var.employee.NAMN.ToString()} ({#var.employee.PERSONNR}, {#var.employee.TITLE}, {#var.employee.ENHET}, {#var.employee.FÖRV})\\\")\\r\\n))\"},\"shouldAssignVariable\":{\"mode\":\"toggle\",\"value\":false}},\"SelectedTypeId\":null,\"PromoteResultAs\":null,\"Name\":\"\",\"Description\":null,\"IsDefault\":null,\"ShouldRetry\":null,\"MaxRetryCount\":null,\"ShouldNotLogResult\":null},{\"Id\":\"Event_1yxk73k\",\"Type\":5,\"Parameters\":{\"expression\":{\"mode\":\"csharp\",\"value\":\"#var.list\"}},\"SelectedTypeId\":null,\"PromoteResultAs\":null,\"Name\":null,\"Description\":null,\"IsDefault\":null,\"ShouldRetry\":null,\"MaxRetryCount\":null,\"ShouldNotLogResult\":null},{\"Id\":\"Event_0p5riwb\",\"Type\":5,\"Parameters\":{\"httpResult\":{\"httpStatusCode\":{\"mode\":\"integer\",\"value\":200},\"httpContent\":{\"mode\":\"csharp\",\"value\":\"#var.list.ToString()\"},\"httpContentType\":{\"mode\":\"text\",\"value\":\"application/json\"},\"httpContentEncoding\":{\"mode\":\"text\",\"value\":\"UTF-8\"},\"httpHeaders\":[]}},\"SelectedTypeId\":\"HttpResult\",\"PromoteResultAs\":null,\"Name\":null,\"Description\":null,\"IsDefault\":null,\"ShouldRetry\":null,\"MaxRetryCount\":null,\"ShouldNotLogResult\":null},{\"Id\":\"FrendsTestElementId\",\"Type\":19,\"Parameters\":{\"input\":{\"Query\":{\"mode\":\"sql\",\"value\":\"SELECT TRIM(A.PERSONNR) PERSONNR, TRIM(A.NAMN) NAMN, TRIM(P.KATBEN) TITLE, TRIM(O.ORG_NIVAA_3) AS FÖRV, TRIM(O.ORG_NIVAA_5) AS ENHET FROM EXTERN_VY.ANSVAR_FUNKTION A\\r\\nINNER JOIN EXTERN_VY.ORGINFO O ON A.PERSONNR = O.PERSONNR AND A.IDNR = O.IDNR\\r\\nINNER JOIN EXTERN_VY.PERSONINFO P ON A.PERSONNR = P.PERSONNR AND A.IDNR = P.IDNR\\r\\nLEFT OUTER JOIN EXTERN_VY.USERINFO X ON X.PERSONNR = A.PERSONNR\\r\\nLEFT OUTER JOIN EXTERN_VY.USERINFO U ON U.PERSONNR = A.ANSVARIG_PERSONNR\\r\\nWHERE A.FUNKTION ='Chef'\\r\\nAND O.FOERETAG = '01'\\r\\nAND P.HUVUDIDNR = 'J'\\r\\nAND P.ANONYM = 'N'\\r\\nAND P.ANST_FOM <= GETDATE() AND (P.ANST_TOM >= GETDATE()  OR P.ANST_TOM IS NULL)\\r\\nAND U.USERID = @username\"},\"Parameters\":[{\"Name\":{\"mode\":\"text\",\"value\":\"username\"},\"Value\":{\"mode\":\"text\",\"value\":\"DAVHAL\"}}],\"ConnectionString\":{\"mode\":\"csharp\",\"value\":\"#env.HeromaSQLConnectionstring\"}},\"options\":{\"CommandTimeoutSeconds\":{\"mode\":\"integer\",\"value\":60},\"SqlTransactionIsolationLevel\":{\"mode\":\"select\",\"value\":\"Default\"}},\"cancellationToken\":null},\"SelectedTypeId\":\"/ProcessTask/2831a40a-71dd-402a-978d-b304597bd7fb/v1\",\"PromoteResultAs\":null,\"Name\":\"Test\",\"Description\":null,\"IsDefault\":null,\"ShouldRetry\":null,\"MaxRetryCount\":null,\"ShouldNotLogResult\":null},{\"Id\":\"Event_1tkaan3\",\"Type\":0,\"Parameters\":{\"routeTemplate\":\"api/opene/rest/listor/heroma/employees\",\"isPrivate\":false,\"corsEnabled\":false,\"allowedOrigins\":\"\",\"allowedSchemes\":\"HTTP,HTTPS\",\"httpMethod\":\"GET\",\"references\":[\"data\",\"data.username\",\"data.httpBody\",\"data.httpMethod\",\"data.httpRequestUri\",\"data.httpClientIp\",\"data.httpCookies\",\"data.body\",\"data.path\",\"data.query\",\"data.header\",\"data.query.username\"],\"openApiDocument\":\"openapi: 3.0.1\\ninfo:\\n  title: Opene - Externa listor\\n  description: \\\"En externa lista är en lista med alternativ till t.ex en kryssruta eller radioknapp i e-tjänsten. Dessa apier returnerar en lista till en sådan fråga i e-tjänsten.\\\\nEn del listor är direkt kopplade mot något verksamhetssystem / ärendehanteringssytem eller direkt mot en databas. Medans vissa listor kan vara enklare där vi läser in alternativen ifrån en vanlig textfil.\\\\nVissa listor kan ha stöd för attributfiltering vilket innebär att man kan sätta attributvärden för att begränsa alternativen i e-tjänsten.\\\"\\n  contact:\\n    name: Andreas Nordman\\n    email: andreas.nordman@ostersund.se\\n  version: 1.0.24\\nservers:\\n  - url: /api/opene/rest/listor\\n    variables:\\n      scheme:\\n        default: https\\n        enum:\\n          - https\\npaths:\\n  /heroma/employees:\\n    get:\\n      tags:\\n        - Heroma\\n      summary: En lista med anställda under en viss chef.\\n      parameters:\\n        - name: username\\n          in: query\\n          required: true\\n          schema:\\n            type: string\\n            description: chefens användarnamn\\n      responses:\\n        '200':\\n          description: Lista med medarbetare under chefen returneras.\\n        default:\\n          description: Ett fel har inträffat\\ntags:\\n  - name: Testlistor\\n    description: Några testlistor\\n  - name: Heroma\\n    description: Listor med koppling mot Heromas databas.\\n  - name: Opene\",\"basePath\":\"/api/opene/rest/listor\",\"auth\":\"None\",\"oAuth2Options\":null},\"SelectedTypeId\":\"HttpApiTrigger\",\"PromoteResultAs\":null,\"Name\":\"API trigger\",\"Description\":null,\"IsDefault\":null,\"ShouldRetry\":null,\"MaxRetryCount\":null,\"ShouldNotLogResult\":null}]",
      "ManualTriggerJson": "[]",
      "IsSubprocess": false,
      "TriggersJson": "[{\"$type\":\"HttpApiTrigger\",\"config\":{\"routeTemplate\":\"api/opene/rest/listor/heroma/employees\",\"isPrivate\":false,\"corsEnabled\":false,\"allowedOrigins\":\"\",\"allowedSchemes\":\"HTTP,HTTPS\",\"httpMethod\":\"GET\",\"references\":[\"data\",\"data.username\",\"data.httpBody\",\"data.httpMethod\",\"data.httpRequestUri\",\"data.httpClientIp\",\"data.httpCookies\",\"data.body\",\"data.path\",\"data.query\",\"data.header\",\"data.query.username\"],\"openApiDocument\":\"openapi: 3.0.1\\ninfo:\\n  title: Opene - Externa listor\\n  description: \\\"En externa lista är en lista med alternativ till t.ex en kryssruta eller radioknapp i e-tjänsten. Dessa apier returnerar en lista till en sådan fråga i e-tjänsten.\\\\nEn del listor är direkt kopplade mot något verksamhetssystem / ärendehanteringssytem eller direkt mot en databas. Medans vissa listor kan vara enklare där vi läser in alternativen ifrån en vanlig textfil.\\\\nVissa listor kan ha stöd för attributfiltering vilket innebär att man kan sätta attributvärden för att begränsa alternativen i e-tjänsten.\\\"\\n  contact:\\n    name: Andreas Nordman\\n    email: andreas.nordman@ostersund.se\\n  version: 1.0.24\\nservers:\\n  - url: /api/opene/rest/listor\\n    variables:\\n      scheme:\\n        default: https\\n        enum:\\n          - https\\npaths:\\n  /heroma/employees:\\n    get:\\n      tags:\\n        - Heroma\\n      summary: En lista med anställda under en viss chef.\\n      parameters:\\n        - name: username\\n          in: query\\n          required: true\\n          schema:\\n            type: string\\n            description: chefens användarnamn\\n      responses:\\n        '200':\\n          description: Lista med medarbetare under chefen returneras.\\n        default:\\n          description: Ett fel har inträffat\\ntags:\\n  - name: Testlistor\\n    description: Några testlistor\\n  - name: Heroma\\n    description: Listor med koppling mot Heromas databas.\\n  - name: Opene\",\"basePath\":\"/api/opene/rest/listor\",\"auth\":\"None\",\"oAuth2Options\":null},\"name\":\"API trigger\",\"id\":\"Event_1tkaan3\",\"shouldNotLogParameters\":null}]",
      "AssemblyName": "Frends.ExecutableProcess.frends_INT005Hero",
      "PackageId": "INT005Hero74ae7f95606a4ea7b2361c928da2f6f3",
      "PackageVersion": "0.1.54.0",
      "UsedTasksJson": "[\"/ProcessTask/2831A40A-71DD-402A-978D-B304597BD7FB/v1\"]",
      "UsedSubprocessesJson": "{}",
      "ProcessExecutionVersion": "4.2.6",
      "FrendsVersion": "5.5.2.557",
      "TargetFramework": "net471",
      "RequiredEnvironmentVariables": [
        "HeromaSQLConnectionstring"
      ],
      "PromotedResultVariablesJson": "[]",
      "MajorVersion": 0,
      "MinorVersion": 1,
      "IsForMonitoringRule": false
    }
  ]
}
